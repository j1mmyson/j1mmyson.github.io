<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..!" /><meta property="og:locale" content="en" /><meta name="description" content="Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..!" /><meta property="og:description" content="Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..!" /><link rel="canonical" href="https://j1mmyson.github.io/posts/WebInGo(2)/" /><meta property="og:url" content="https://j1mmyson.github.io/posts/WebInGo(2)/" /><meta property="og:site_name" content="J1mmyson" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-14T00:42:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..!" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-04-14T00:42:00+09:00","datePublished":"2021-04-14T00:42:00+09:00","description":"Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..!","headline":"[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..!","mainEntityOfPage":{"@type":"WebPage","@id":"https://j1mmyson.github.io/posts/WebInGo(2)/"},"url":"https://j1mmyson.github.io/posts/WebInGo(2)/"}</script><title>[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&아웃 기능 구현..! | J1mmyson</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="J1mmyson"><meta name="application-name" content="J1mmyson"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/favicons/android-chrome-512x512.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">J1mmyson</a></div><div class="site-subtitle font-italic">게임 개발이 하고 싶어요..</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/j1mmyson" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['bwson98','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&아웃 기능 구현..!</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&아웃 기능 구현..!</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/j1mmyson">Byungwook Son</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1618328520" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-04-14 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2614 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><h1 id="go로-만드는-웹-2-회원가입-로그인아웃-기능-구현">Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..!</h1><h2 id="-2021-04-12"><span class="mr-2"># 2021-04-12</span><a href="#-2021-04-12" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>드디어 어제..!<br /> 내가 개인 프로젝트로 진행하던(<code class="language-plaintext highlighter-rouge">Crud.gg</code>라고 하겠습니다) <code class="language-plaintext highlighter-rouge">crud.gg</code>에 로그인, 로그아웃, 회원가입 기능을 붙였다. 이를 구현하기위해 <code class="language-plaintext highlighter-rouge">1. 쿠키와 세션</code>, <code class="language-plaintext highlighter-rouge">2. 비밀번호 암호화</code>, <code class="language-plaintext highlighter-rouge">3. db 분리</code>, <code class="language-plaintext highlighter-rouge">4. 로그인 원리?</code> 등의 키워드로 공부를 하였다. 그 결과 ! 아직 보완하고 정리해야할 부분이 많이 남아있지만 회원가입을 하고 로그인, 로그아웃 하는 데 까지 구현을 성공하였다 ㅠㅠ.</p><p>이제 코드 정리도 좀 하고 일정시간이 지나면 세션을 삭제하는 기능을 구현할 예정이고 어떤 api를 호출하여 좀 재미있고 흥미로운 프로젝트를 만들 수 있을까 고민중이다.<br /> 머릿속에 있는 생각은 두 가지 있는데 하나는 <code class="language-plaintext highlighter-rouge">블랙서바이벌:영원회귀 전적검색</code>이고 다른 하나는 <code class="language-plaintext highlighter-rouge">하스스톤 api</code>를 호출하여 유저들에게 유익한 컨텐츠를 제공할 수 있게 하는 것이다.<br /> <code class="language-plaintext highlighter-rouge">블랙서바이벌</code>의 경우 얼마전에 api를 제공했다고 들었는데 아직 자세히 찾아보지는 못한 상태이다.<br /> <code class="language-plaintext highlighter-rouge">하스스톤</code>도 <code class="language-plaintext highlighter-rouge">블랙서바이벌</code>과 같이 내가 굉장히 좋아하는 게임인데 전적 검색기능을 제공하는 사이트가 없어 내가 한번 만들어 볼까 생각을 했었는데 아쉽게도 블리자드 api에서는 게임유저들의 전적에 대한 데이터를 제공해주지 않았다 ㅠㅠ.(제공을 해주지 않았기 때문에 하스스톤 전적검색 사이트도 없었겠지…) <br /> 아무튼 컨텐츠의 경우 일단 좀 더 <code class="language-plaintext highlighter-rouge">crud.gg</code>를 튼튼하게 만들고 난 후 다시 고민해볼 생각이다.<br /> 이제 내가 어떻게 지금까지의 웹을 구현했는지 기록하는 시간을 가져보겠다.</p><h2 id="database"><span class="mr-2">DataBase</span><a href="#database" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>우선 데이터 베이스는 두 개의 테이블로 구성을 하였다.<br /> 하나는 클라이언트의 상태를 유지를 위한 <code class="language-plaintext highlighter-rouge">session</code>테이블, 다른 하나는 모든 회원의 정보를 갖는 <code class="language-plaintext highlighter-rouge">user</code>테이블이다. <code class="language-plaintext highlighter-rouge">session</code>테이블에는 클라이언트의 쿠키와 대조하여 상태를 유지할 수 있게끔 해주는 <code class="language-plaintext highlighter-rouge">session_id</code>필드와 <code class="language-plaintext highlighter-rouge">session_id</code>와 <code class="language-plaintext highlighter-rouge">user</code>테이블의 연결을 위한 <code class="language-plaintext highlighter-rouge">user_id</code>필드가 있고 <code class="language-plaintext highlighter-rouge">user_id</code>는 <code class="language-plaintext highlighter-rouge">user</code>테이블의 primary key인 <code class="language-plaintext highlighter-rouge">id</code>필드에 대한 외래키이다.</p><p>한번 로그인을 하고 로그인한 상태를 유지할 때 <code class="language-plaintext highlighter-rouge">session_id</code>와 <code class="language-plaintext highlighter-rouge">user_id</code>만 있으면 제 기능을 할 수 있기 때문에 불필요한 데이터 호출을 줄이기 위해 테이블을 나누었다. (이 글을 쓰다가 생각났는데 <code class="language-plaintext highlighter-rouge">session</code>테이블의 <code class="language-plaintext highlighter-rouge">user_id</code>를 primary key로 해주어 중복 로그인을 방지해야겠다..)<br /> 그렇게 해서 만들어진 두 테이블이다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c"># session table</span>
+------------+--------------+------+-----+---------+-------+
| Field      | Type         | Null | Key | Default | Extra |
+------------+--------------+------+-----+---------+-------+
| session_id | varchar<span class="o">(</span>100<span class="o">)</span> | NO   |     | NULL    |       |
| user_id    | varchar<span class="o">(</span>100<span class="o">)</span> | NO   | MUL | NULL    |       |
+------------+--------------+------+-----+---------+-------+
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c"># user table</span>
+----------+--------------+------+-----+---------+-------+
| Field    | Type         | Null | Key | Default | Extra |
+----------+--------------+------+-----+---------+-------+
| <span class="nb">id</span>       | varchar<span class="o">(</span>30<span class="o">)</span>  | NO   | PRI | NULL    |       |
| password | varchar<span class="o">(</span>255<span class="o">)</span> | YES  |     | NULL    |       |
| created  | datetime     | NO   |     | NULL    |       |
| name     | varchar<span class="o">(</span>30<span class="o">)</span>  | NO   |     | NULL    |       |
+----------+--------------+------+-----+---------+-------+
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">user</code> 테이블을 보면 <code class="language-plaintext highlighter-rouge">password</code>필드만 길이가 255인 것을 확인할 수 있다 ㅋㅋ. 이는 보안을 위해 데이터베이스에 비밀번호를 암호화 하여 저장해주었기 때문이다. 너무 당연한 사실인데 평소에는 생각을 못했던 부분이었다. 비밀번호를 plain text 그대로 저장해버리면 보안에 있어서 매우 취약하고 악용될 여지도 있을 것이다.<br /> 그래서 아마 해싱과 같은 방법으로 비밀번호를 저장하게 되어 db가 유출되어도 비밀번호 원문을 알지 못해 2차 피해를 막을 수 있을것이다. 이미 시중에 나와있는 서비스의 대부분의 경우 비밀번호 찾기 기능을 하면 원래의 비밀번호를 알려주지않고 임시 비밀번호를 알려주는 이유였다 ㅋㅋㅋ. (임시비밀번호 제공 기능도 구현해야겠네..)</p><h2 id="회원가입"><span class="mr-2">회원가입</span><a href="#회원가입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>사실 회원가입의 경우에는 비교적 특별할 게 없었다.<br /> 그냥 회원가입 페이지에서 <code class="language-plaintext highlighter-rouge">post</code> 요청이 오면 해당 페이지의 form데이터를 받아와 DB에 넣어주는 기능만 하면 되었다. (또 글을 쓰다가 생각 났는데 사용자가 유효하지 않은 입력을 넣어주었을 때 예외처리도 해주어야겠다.)</p><p>아직 회원가입을 포함해 모든 코드 정리를 하지 않았지만 코드를 보자.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">signUp</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">req</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// 이미 로그인이 되어있다면 index페이지로 redirect.</span>
	<span class="k">if</span> <span class="n">alreadyLoggedIn</span><span class="p">(</span><span class="n">req</span><span class="p">)</span> <span class="p">{</span> 
		<span class="n">http</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">"/index"</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusSeeOther</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
    <span class="c">// 이부분은 그냥 페이지를 띄워주는 건데 굳이 if문에 넣지 않아도 될것같다.</span>
	<span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">Method</span> <span class="o">==</span> <span class="n">http</span><span class="o">.</span><span class="n">MethodGet</span> <span class="p">{</span> 
		<span class="n">tpl</span><span class="o">.</span><span class="n">ExecuteTemplate</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">"signup.gohtml"</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="c">// "submit"버튼을 누르면 실행되는 블럭. db에 user정보를 저장하고 로그인페이지로 redirect.</span>
	<span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">Method</span> <span class="o">==</span> <span class="n">http</span><span class="o">.</span><span class="n">MethodPost</span> <span class="p">{</span>
		<span class="n">CreateUser</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
		<span class="n">http</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">"/"</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusSeeOther</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="로그인"><span class="mr-2">로그인</span><a href="#로그인" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>로그인 기능 부터 할 이야기가 많지만… 최대한 짧게 정리하겠다 ㅋㅋ..<br /> 로그인 기능을 구현하기 위해 어떻게 상태를 유지해야 하나.. 찾아보다가 쿠키와 세션에 대해 알게 되었고 공부를 하고나서 바로 적용시켰다.</p><p><img data-src="../../assets/img/posts/devlog/login.png" alt="login page" data-proofer-ignore></p><p>로그인 페이지로 들어왔을 때 이미 로그인이 된 상태라면 index페이지로 redirect해주었다.<br /> 회원가입 버튼을 누르면 회원가입 페이지로, 로그인버튼을 누르면 입력한 id, pw를 검증하여 인덱스 페이지로 이동하게끔 해주었다. 코드는 아래와 같다. 마찬가지로 코드 설명은 주석으로 대체!</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">login</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">req</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// 이미 로그인이 되었다면 index page로 redirect</span>
	<span class="k">if</span> <span class="n">alreadyLoggedIn</span><span class="p">(</span><span class="n">req</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">http</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">"/index"</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusSeeOther</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
    <span class="c">// login 버튼이 눌렸다면</span>
	<span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">Method</span> <span class="o">==</span> <span class="n">http</span><span class="o">.</span><span class="n">MethodPost</span> <span class="p">{</span>
		<span class="n">user</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ReadUser</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span> <span class="c">// 입력받은 데이터가 db에 존재하는지 확인</span>
		
        <span class="c">// 없다면 에러 페이지 반환 =&gt; 추후에 login page에 알람을 띄워주는 형태로 해주자</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span> 
			<span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">(),</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusForbidden</span><span class="p">)</span>
			<span class="k">return</span>
		<span class="p">}</span>
		<span class="n">sID</span> <span class="o">:=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">New</span><span class="p">()</span> <span class="c">// session_id로 쓸 uuid 생성</span>
        <span class="c">// name이 session이고 Value가 uuid인 쿠키를 생성 =&gt; 상태유지를 위함1</span>
		<span class="n">c</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">http</span><span class="o">.</span><span class="n">Cookie</span><span class="p">{</span>
			<span class="n">Name</span><span class="o">:</span>  <span class="s">"session"</span><span class="p">,</span>
			<span class="n">Value</span><span class="o">:</span> <span class="n">sID</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
		<span class="p">}</span>
		<span class="n">http</span><span class="o">.</span><span class="n">SetCookie</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="c">// session table에 uuid와 id를 저장 =&gt; 상태유지를 위함2</span>
		<span class="n">CreateSession</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span>
        <span class="c">// 로그인 완료, 인덱스페이지로 redirect</span>
		<span class="n">http</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">"/index"</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusSeeOther</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="n">tpl</span><span class="o">.</span><span class="n">ExecuteTemplate</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">"login.gohtml"</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="../../assets/img/posts/devlog/2021-04-14/indexPage.PNG" alt="index page" data-proofer-ignore> 이렇게 로그인을 성공하게 되면 일단 위와 같이 내가 로그인 한 회원의 정보를 볼 수 있게끔 해주었다.</p><h2 id="로그아웃"><span class="mr-2">로그아웃</span><a href="#로그아웃" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>로그아웃은 더더더더욱 간단하다.<br /> 그냥 <code class="language-plaintext highlighter-rouge">session</code>쿠키, <code class="language-plaintext highlighter-rouge">session</code>쿠키와 대응하는 <code class="language-plaintext highlighter-rouge">session</code> 테이블의 행을 삭제해주면 끝이기 때문.<br /> 그렇게 되면 더이상 상태를 유지해주는 뭐가 없기때문에 로그아웃이 된다.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">logout</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">req</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// 로그인이 되어있지 않다면 로그인 페이지로 redirect</span>
	<span class="k">if</span> <span class="o">!</span><span class="n">alreadyLoggedIn</span><span class="p">(</span><span class="n">req</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">http</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">"/"</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusSeeOther</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">req</span><span class="o">.</span><span class="n">Cookie</span><span class="p">(</span><span class="s">"session"</span><span class="p">)</span>
	<span class="c">// delete session</span>
	<span class="n">DeleteSession</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Value</span><span class="p">)</span>

	<span class="c">// cookie의 maxage가 음수인 것은 삭제를 의미한다</span>
	<span class="n">c</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">http</span><span class="o">.</span><span class="n">Cookie</span><span class="p">{</span>
		<span class="n">Name</span><span class="o">:</span>   <span class="s">"session"</span><span class="p">,</span>
		<span class="n">Value</span><span class="o">:</span>  <span class="s">""</span><span class="p">,</span>
		<span class="n">MaxAge</span><span class="o">:</span> <span class="o">-</span><span class="m">1</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="n">http</span><span class="o">.</span><span class="n">SetCookie</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	
    <span class="c">// cookie와 session을 삭제하였으니 로그인 페이지로 redirect!</span>
	<span class="n">http</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">"/"</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusSeeOther</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="마치며"><span class="mr-2">마치며..</span><a href="#마치며" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>위에서 보여준 코드들은 일단 페이지를 띄워주는 코드들이고 이 외에도 세션에 대한 코드, DB를 다루는 코드 등 (사실 이부분이 더 많긴함) 이 있지만 글에서는 이 정도로만 정리하겠다. 전체 코드 소스는 <a href="https://github.com/j1mmyson/Go_CRUD">여기서</a> 확인할 수 있다.<br /> 오늘 내가 혼자 만들고있는 <code class="language-plaintext highlighter-rouge">crud.gg</code> 웹 프로젝트의 중간 진행상황에 대해 정리해보았는데 막상 이렇게 정리해보니까 되게 별거 없다고 느껴졌다 ㅋㅋㅋㅋ.. 아직 그만큼 할 일이 많이 남았고 고민해야 할 부분도 많이 남은 것 같다.</p><p>다음엔 내가 이 글을 쓰며 중간중간 기록한 보완점 들, 일정시간이 지나면 로그아웃이 되는 기능 등을 구현하여 돌아오겠다. 일단 내일 있는 프로그래머스 월간 코드 챌린지를 준비해야 한다.. 얼마전에 있었던 <strong>스타트업 코딩 페스티벌 2021</strong>때 봤던 코테 이후로는 알고리즘 문제를 단 한 문제도 풀지 않은 것 같다 ㅋㅋㅋㅋ. 1~2주 정도 알고리즘을 쉬었으니 다시 꾸준히…… 알고리즘 문제를 풀어줘야겠다..</p><p>프로그래머스 월간 코드챌린지를 마치고 <code class="language-plaintext highlighter-rouge">코드 정리</code>, <code class="language-plaintext highlighter-rouge">앞서 거론한 기능들 구현</code>, <code class="language-plaintext highlighter-rouge">흥미로운 api 찾고 적용해보기</code> 등의 컨텐츠를 잘 준비해 오겠다.</p><h3 id="todo"><span class="mr-2">Todo</span><a href="#todo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>중복 로그인 방지<li>비밀번호 찾기<li>(로그인 시) 입력 예외처리<li>일정시간 경과 시 로그아웃<li>코드정리<li>api 찾기<li>…</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/development/'>Development</a>, <a href='/categories/devlog/'>Devlog</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/golang/" class="post-tag no-text-decoration" >golang</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/side-project/" class="post-tag no-text-decoration" >side project</a> <a href="/tags/cookie/" class="post-tag no-text-decoration" >cookie</a> <a href="/tags/session/" class="post-tag no-text-decoration" >session</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..! - J1mmyson&amp;url=https://j1mmyson.github.io/posts/WebInGo(2)/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..! - J1mmyson&amp;u=https://j1mmyson.github.io/posts/WebInGo(2)/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://j1mmyson.github.io/posts/WebInGo(2)/&amp;text=[Devlog] Go로 만드는 웹 (2): 회원가입, 로그인&amp;아웃 기능 구현..! - J1mmyson" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/StringsPackage/">[Go] strings package 파헤치기 (상)</a><li><a href="/posts/BOJ6064/">백준 6064 카잉달력, 이 문제를 풀지 못한 사람들을 위한 풀이</a><li><a href="/posts/Rest_for_Noobies/">[번역/요약] 협업을 위한 REST API Best Practices</a><li><a href="/posts/Dijkstra/">[알고리즘] 그림으로 이해하는 다익스트라(Dijkstra) 알고리즘</a><li><a href="/posts/naverInterview/">떨어진 네이버 트랙인턴 면접 복기하기 (Search CIC)</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/js/">js</a> <a class="post-tag" href="/tags/side-project/">side project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/blogging/">blogging</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/cookie/">cookie</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/WebInGo(1)/"><div class="card-body"> <em class="timeago small" data-ts="1615906800" > 2021-03-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Devlog] Go로 만드는 웹 (1): MySQL 연동</h3><div class="text-muted small"><p> Go로 만드는 웹 (1): MySQL 연동 현재 golang, mysql을 사용하여 로그인, 회원가입을 하는 웹페이지를 만들고 있다. 음.. 일단 이 처음부터 다른 사람이 짜놓은 코드라던가 best practice는 보지 않고 만들어 보기로 했다. 뭔가 한번 봐버리면 그 틀에서 헤어 나오지 못할까 봐 일단 내 방식대로 완성을 시키고 다른 사람들이 주...</p></div></div></a></div><div class="card"> <a href="/posts/BoardInGo(1)/"><div class="card-body"> <em class="timeago small" data-ts="1622140680" > 2021-05-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Devlog] Golang으로 게시판을 구현해보았다(1)</h3><div class="text-muted small"><p> [Devlog] Golang으로 게시판을 구현해보았다(1) #2021-05-28 아직 완성 짓지 못한 프로젝트이긴 한데 아주 기본적인 기능들은 구현이 된 것 같아 중간 정리를 해보려 한다. 프로젝트 아이디어가 떠오르지 않아 뭘 해야 하나 고민하던 찰나에 남들 다 구현할 줄 안다는 게시판,, (솔직히 대충 머리로 상상 코딩해놓고 게시판 정도는 쉽겠지...</p></div></div></a></div><div class="card"> <a href="/posts/myFirstProject/"><div class="card-body"> <em class="timeago small" data-ts="1626516240" > 2021-07-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Devlog] 첫번째 프로젝트를 시작해보았다.</h3><div class="text-muted small"><p> 드디어 첫 개인 플젝을..! 훈련소를 다녀온 지 3주가 다 되어간다. 훈련소를 마치고 일주 정도 있다가 나도 나름 프로젝트라고 말할 수 있을 정도의 프로젝트를 하나쯤 만들어 보자고 다짐하게 되었고 이번 프로젝트를 시작하게 되었다. 프로젝트를 시작한 지 2주 정도 지났는데 65% 정도 진행을 한 것 같아 중간 정리 글을 남기게 되었다. 이제 내 기억을...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/301redirect/" class="btn btn-outline-primary" prompt="Older"><p>[삽질] 자꾸 예상치 못한 301 redirect가 일어날 때...</p></a> <a href="/posts/HelloAWS/" class="btn btn-outline-primary" prompt="Newer"><p>[AWS/Go] AWS에 웹을 구축해보자</p></a></div><script src="https://utteranc.es/client.js" repo="j1mmyson/j1mmyson.github.io" issue-term="pathname" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/j1mmyson">Byungwook Son</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/js/">js</a> <a class="post-tag" href="/tags/side-project/">side project</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/blogging/">blogging</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/cookie/">cookie</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-00H4VC1BYN"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-00H4VC1BYN'); }); </script>
